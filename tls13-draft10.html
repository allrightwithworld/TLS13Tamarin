<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Automated Analysis of TLS 1.3</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Automated Analysis of TLS 1.3</h1>
      <h2 class="project-tagline"></h2>
      <a href="docs/tls13tamarin.pdf" class="btn">Technical paper</a>
      <a href="https://github.com/tls13tamarin/TLS13Tamarin" class="btn">View on GitHub</a>
    </section>

    <section class="main-content">
      <h1>
<a id="automated-analysis-of-tls-13-0-rtt-resumption-and-delayed-authentication" class="anchor" href="#automated-analysis-of-tls-13-0-rtt-resumption-and-delayed-authentication" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Automated Analysis of TLS 1.3: 0-RTT, Resumption and Delayed Authentication</h1>

<p>
<a href="http://www.cs.ox.ac.uk/people/cas.cremers/intro.html">Cas Cremers</a>, 
<a href="https://www.cs.ox.ac.uk/people/marko.horvat">Marko Horvat</a>, 
<a href="https://pure.royalholloway.ac.uk/portal/en/persons/sam-scott%2822345852-62ac-47be-8e56-84ac63717a5f%29.html">Sam Scott</a>, 
<a href="http://pure.rhul.ac.uk/portal/en/persons/thyla-van-der-merwe%289a30d837-2dd5-47ca-9db8-5f825b32023c%29.html">Thyla van der Merwe</a>
</br>
<small><a href="https://www.cs.ox.ac.uk/people/cas.cremers">University of Oxford, UK</a> &amp; Royal Holloway, University of London, UK</small>
</p>

<p><a href="docs/tls13tamarin.pdf"><b>Download the technical paper</b></a><br>
<small>A version of this paper, substantially similar in content to this version, has been accepted to appear at <a href="http://www.ieee-security.org/TC/SP2016/">IEEE S&amp;P 2016</a>.</small></p>

<h2>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Introduction</h2>

<p style="text-align:justify">The TLS protocol is used globally by millions of users on a daily basis,
serving as the core building block for Internet security. The various flaws identified 
in TLS 1.2 and below, be they implementation- or specification-based, have prompted 
the TLS Working Group to adopt an "analysis-before-deployment" design paradigm in 
drafting the next version of the protocol. After a development process of 
many months, the <a href="https://github.com/tlswg/tls13-spec">TLS 1.3 specification</a>
is nearly complete. </p>

<p style="text-align:justify">In the spirit of contributing 
towards this new design philosophy, we model the TLS 1.3 specification using 
the Tamarin prover, a tool for the automated analysis of security protocols. 
We show that <a href="https://tools.ietf.org/html/draft-ietf-tls-tls13-10">revision 10 of the specification</a> meets the goals of authenticated 
key exchange for any combination of unilaterally and mutually authenticated
handshakes. </p>

<p style="text-align:justify">By extending our revision 10 model to incorporate the desired delayed client
authentication mechanism, we uncovered a potential attack in which an
adversary is able to successfully impersonate a client during a
PSK-resumption handshake.  Our attack highlighted the
strict necessity of including more information in the client signature contents. The IETF TLS Working Group updated
<a href="https://tools.ietf.org/html/draft-ietf-tls-tls13-11">revision 11 of the TLS 1.3 specification draft</a> based on our report.</p>

<p style="text-align:justify">Our work provides the first supporting evidence for the security of
several complex protocol mode interactions in TLS 1.3. Our formal 
model can be extended to future releases, 
thus being of long-lasting benefit.
We give a brief overview of our methodology in the following sections.</p>

<h2>
<a id="tls-13" class="anchor" href="#tls-13" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>TLS 1.3</h2>

<p style="text-align:justify">In comparison to TLS 1.2, TLS 1.3 encrypts more of the handshake, reduces handshake latency and employs only AEAD schemes. The new handshake modes of TLS 1.3 include a 1-RTT initial (EC)DHE mode, 
a 0-RTT mode, a (Pre-Shared Key) PSK mode and a PSK-DHE mode. 
For further details see the <a href="https://github.com/tlswg/tls13-spec">TLS 1.3 specification draft</a>.</p>

<h2>
<a id="building-a-model" class="anchor" href="#building-a-model" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Building a Model</h2>

<p style="text-align:justify">For our analysis, we use the Tamarin prover, a 
tool for the symbolic analysis of security protocols. Tamarin
enables us to precisely specify and analyse the secrecy and
authentication properties of the various handshake modes. Furthermore,
Tamarin's multiset rewriting semantics are well-suited for modelling the
complex transition system implied by the TLS 1.3 specification; the tool
allows us to analyse the interaction of an unbounded number of concurrent
TLS sessions. 
The tool and further documentation can be
found on its 
<a href="https://github.com/tamarin-prover/tamarin-prover">webpage</a>. </p>

<p style="text-align:justify">The first step of our analysis is to construct an abstraction of the 
handshake and record protocols which we then encode as Tamarin rules. Rules capture 
honest-party and adversary actions alike. In the case of legitimate clients and servers, 
our constructed model rules generally correspond to all processing actions
associated with respective flights of messages. Our first client rule, for instance, 
captures a client generating and sending all necessary parameters as part of the first 
flight of an (EC)DHE handshake, as well as keeping track of them in the local client state.
This rule, <code>C_1</code>, is visible in the client state machine diagram below. The diagram 
represents the union of all the options that a client has in different executions. </p>

<img alt="Client state machines for TLS 1.3 revision 10" src="img/client-sm.png">
<p style="text-align:justify">Partial client state machines for TLS 1.3 revision 10, as modelled in our analysis.</p>

<h2>
<a id="proving-stated-goals-and-security-properties" class="anchor" href="#proving-stated-goals-and-security-properties" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Proving Stated Goals and Security Properties</h2>

<p style="text-align:justify">The second step of the analysis involves encoding the desired security properties as 
Tamarin lemmas. The goal of the TLS handshake protocol is 
to allow for unilateral or, optionally, mutual entity authentication of communicating
parties, as well as to establish a shared secret that is unavailable to 
eavesdroppers and adversaries who can place themselves in the middle of the 
connection. The TLS record protocol is intended to provide confidentiality 
and integrity of application data. Hence, we encode the following properties as lemmas </p>

<ul>
<li>unilateral authentication of the server (mandatory),</li>
<li>mutual authentication (optional) </li>
<li>confidentiality and perfect forward secrecy of session keys and</li>
<li>integrity of handshake messages.</li>
</ul>

<p style="text-align:justify">and aim to show that each property holds. </p>

<p>While Tamarin can automatically construct proofs for simple protocols,
its proof-finding heuristics are not yet strong enough to automatically
generate full proofs for TLS 1.3.
In practice this meant that we augmented Tamarin's search with substantial manual effort: inspecting partial proofs and deducing appropriate hints (in the form of lemmas) to guide Tamarin's proof search.</p>

<p style="text-align:justify">Using this approach, we establish that revision 10 of the TLS 1.3 specification meets the goals of 
authenticated key exchange in all possible combinations of 
client, server, and adversary behaviours. </p>

<h2>
<a id="attacking-client-authentication" class="anchor" href="#attacking-client-authentication" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Attacking Client Authentication</h2>

<p style="text-align:justify">In extending our revision 10 model to include the <a href="https://www.ietf.org/proceedings/93/slides/slides-93-tls-2.pdf">delayed client authentication mechanism</a>
as proposed by the TLS Working Group, we found an attack which violates client authentication, as an 
adversary can can impersonate a client when communicating with a server. The 
attack is similar to the <a href="https://mitls.org/pages/attacks/3SHAKE">Triple Handshake attack</a> and works as follows: </p>

<p style="text-align:justify">Step 1: Alice (the victim client) starts a connection with Charlie (the man-in-the-middle),
and Charlie starts a connection with Bob (the targeted server). In both connections
a PSK is established. Alice shares <code>PSK_1</code> with Charlie and Charlie shares <code>PSK_2</code> 
with Bob. </p>

<img src="img/att1.png">

<p style="text-align:justify">Step 2: Alice resumes a connection with Charlie using <code>PSK_1</code>. Alice generates 
a random nonce <code>nc</code> and this is sent to Charlie. Charlie reuses this nonce
to initiate a PSK-resumption handshake with Bob. Bob responds with a random 
nonce <code>ns</code>, and the server Finished message, computed using <code>PSK_2</code>. Charlie
reuses <code>ns</code> and recomputes the Finished message for Alice using <code>PSK_1</code>. Alice returns 
her <code>Finished</code> message to Charlie who recomputes the Finished message for 
Bob using <code>PSK_2</code>. At this point, Alice and Charlie share session keys
derived from <code>PSK_1</code> and Charlie and Bob share session keys derived from 
<code>PSK_2</code>. </p>

<img src="img/att2.png">

<p style="text-align:justify">Step 3: Following resumption, Charlie attempts to make a request of Bob that 
requires client authentication. Charlie is subsequently prompted for his 
certificate and verification.  Charlie re-encrypts this request for Alice. 
To compute the verification signature, Alice uses the <code>session_hash</code> value, which is 
defined as the hash of all handshake messages 
excluding the <code>Finished</code> messages. This session_hash value will match the one 
of Charlie and Bob, and hence Charlie can re-encrypt Alice's signature for Bob, 
who accepts Alice's certificate and verification as valid authentication for Charlie. </p>

<img src="img/att3.png">

<p style="text-align:justify">The attack is possible due to the lack of a strong binding between the client signature 
and the session for which that signature is intended. We note that revision 11 
of the TLS 1.3 specification defines the client signature based on a Handshake Context 
value that includes the <code>Finished</code> message. This appears to address the attack as 
the adversary would now need to force the Finished messages to match across 
the two sessions. Although the inclusion of the <code>Finished</code> message in the Handshake 
Context message was suggested in <a href="https://github.com/tlswg/tls13-spec/pull/316">Pull Request #316</a>, the TLS Working 
Group was unaware of the strict requirement to mitigate this attack.</p>

<h2>
<a id="downloads" class="anchor" href="#downloads" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Downloads</h2>

<p style="text-align:justify">Download the <a href="docs/tls13tamarin.pdf">technical paper</a>.<br>
Download the Real World Crypto <a href="http://www.realworldcrypto.com/rwc2016/program/Automated%20Analysis%20of%20TLS%201.3%20RWC2016.pdf?attredirects=0&amp;d=1">slides</a>. </p>

<h2>
<a id="support" class="anchor" href="#support" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Support</h2>

<p style="text-align:justify">Part of this work was completed whilst Sam Scott and Thyla van der Merwe were interns at Mozilla. We would like to thank Eric Rescorla, Martin Thomson and the TLS
Working Group for their invaluable inputs to this work by way of numerous
clarifying conversations. </p>

      <footer class="site-footer">
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
